#!/bin/zsh
# SCADA Vulnerability Analyzer
# This script identifies common vulnerabilities in SCADA systems.

# Define log file
LOG_FILE="scada_vulnerability_report.log"

# Function to scan for open ports
scan_ports() {
    read -r -p "Enter the SCADA system's IP address: " ip
    read -r -p "Enter the port range to scan (e.g., 1-1000): " port_range

    echo "Scanning open ports on $ip in the range $port_range..." | tee -a "$LOG_FILE"
    for port in $(seq $(echo $port_range | cut -d- -f1) $(echo $port_range | cut -d- -f2)); do
        (echo > /dev/tcp/$ip/$port) &>/dev/null && echo "Port $port is OPEN" | tee -a "$LOG_FILE" || echo "Port $port is CLOSED"
    done
}

# Function to check for default credentials
check_default_credentials() {
    read -r -p "Enter the SCADA system's IP address: " ip
    read -r -p "Enter the admin interface port (e.g., 8080): " port

    echo "Checking for default credentials on $ip:$port..." | tee -a "$LOG_FILE"
    for creds in "admin:admin" "root:root" "admin:1234"; do
        username=$(echo $creds | cut -d: -f1)
        password=$(echo $creds | cut -d: -f2)

        response=$(curl -s -u $username:$password http://$ip:$port)
        if [[ $response =~ "200 OK" ]]; then
            echo "Default credentials found: $username:$password" | tee -a "$LOG_FILE"
            return
        fi
    done
    echo "No default credentials detected." | tee -a "$LOG_FILE"
}

# Function to analyze system configuration
analyze_configuration() {
    read -r -p "Enter the SCADA system's IP address: " ip

    echo "Analyzing system configuration on $ip..." | tee -a "$LOG_FILE"
    # Simulate configuration checks
    if ping -c 1 $ip &>/dev/null; then
        echo "Ping to $ip successful: System is reachable." | tee -a "$LOG_FILE"
    else
        echo "Ping to $ip failed: System is unreachable." | tee -a "$LOG_FILE"
        return
    fi

    echo "Checking for weak encryption protocols..." | tee -a "$LOG_FILE"
    weak_protocols=("TLSv1.0" "SSLv3")
    for protocol in "${weak_protocols[@]}"; do
        if openssl s_client -connect $ip:443 -tls1_2 2>&1 | grep -q "$protocol"; then
            echo "Weak protocol detected: $protocol" | tee -a "$LOG_FILE"
        else
            echo "Protocol $protocol not detected." | tee -a "$LOG_FILE"
        fi
    done
}

# Main menu
while true; do
    echo "SCADA Vulnerability Analyzer"
    echo "1. Scan for Open Ports"
    echo "2. Check for Default Credentials"
    echo "3. Analyze System Configuration"
    echo "4. Exit"
    read -r -p "Choose an option: " choice

    case $choice in
        1)
            scan_ports
            ;;
        2)
            check_default_credentials
            ;;
        3)
            analyze_configuration
            ;;
        4)
            echo "Exiting SCADA Vulnerability Analyzer."
            exit 0
            ;;
        *)
            echo "Invalid option. Please choose a valid action."
            ;;
    esac
done
